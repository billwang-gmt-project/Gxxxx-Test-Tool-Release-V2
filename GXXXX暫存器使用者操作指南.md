# GXXXX 暫存器使用操作指南

## 讀取暫存器

### 讀取單一暫存器

1. 在樹狀檢視中選擇目標暫存器
2. 點擊「Read」按鈕
3. 數值會更新在顯示區域中

### 讀取所有暫存器

1. 點擊「Read All Registers」按鈕
2. 所有暫存器數值會在樹狀檢視中更新

**Console 輸出範例**：
```
[14:30:12] INFO: Reading register GPIO_CTRL (0x10)
[14:30:12] INFO: Read value: 0x05
```

## 寫入暫存器

### 欄位編輯方式

| 欄位類型 | 編輯方式 |
|---------|---------|
| **核取方塊（Checkbox）** | 點擊切換（適用於 1-bit 欄位） |
| **數值微調器（Numeric Spinner）** | 點擊箭頭或直接輸入數值（適用於多位元欄位） |
| **文字方塊（Text Box）** | 輸入數值後按 Enter 確認 |

**支援的數值格式**：
- 十六進位：`0x1A`
- 十進位：`26`
- 二進位：`0b00011010`

### 寫入操作

**寫入單一暫存器**：
1. 編輯欄位數值
2. 點擊「Write」按鈕
3. 數值傳送至硬體

**寫入所有暫存器**：
1. 編輯多個暫存器
2. 點擊「Write All Registers」按鈕
3. 所有已修改的暫存器會寫入硬體

## 進階功能

### AutoWrite（自動寫入）

**啟用方式**：在右鍵選單中勾選「Auto Write」。

**行為**：編輯欄位後，數值會立即寫入硬體（無需手動點擊「Write」按鈕）。

**適用場景**：
- 即時測試
- 參數調校

### AutoVerify（自動驗證）

**啟用方式**：在右鍵選單中勾選「Auto Verify」。

**行為**：寫入後，系統會自動讀回並比對數值。

**結果顯示**：
- 綠色：數值一致（寫入成功）
- 紅色：數值不一致（寫入失敗）

**注意**：AutoVerify 需先啟用 AutoWrite 才能使用。

**Console 輸出範例**：
```
[14:40:15] INFO: Writing register GPIO_CTRL (0x10)
[14:40:15] INFO: Write value: 0x07
[14:40:15] INFO: Verify: Read-back value matches (0x07)
```

## 右鍵選單

在暫存器或欄位上點擊右鍵可顯示右鍵選單：

```
+--- 右鍵選單 --------------------------------+
| R  讀取暫存器（Read Register）               |
| W  寫入暫存器（Write Register）              |
| ------------------------------------        |
| 重設顏色（Reset Colors）                     |
| 取消全選（Deselect All）                     |
| 數值格式（Value Format）>                    |
|   [ ] 二進位（Binary）                       |
|   [x] 十六進位（Hex）                        |
|   [ ] 十進位（Decimal）                      |
| ------------------------------------        |
| [ ] 自動寫入（Auto Write）(_W)               |
| [ ] 自動驗證（Auto Verify）(_V)              |
| ------------------------------------        |
| [ ] 顯示資訊面板（Show Info Panel）(_I)       |
+---------------------------------------------+
```

**基本操作**：

| 項目 | 功能 |
|------|------|
| **讀取暫存器（Read Register）** | 讀取所選暫存器的數值 |
| **寫入暫存器（Write Register）** | 將數值寫入所選暫存器 |
| **重設顏色（Reset Colors）** | 清除所有暫存器的顏色標示 |
| **取消全選（Deselect All）** | 取消選取所有樹狀節點 |

**顯示設定**：

| 項目 | 功能 |
|------|------|
| **數值格式（Value Format）** | 選擇顯示格式（二進位/十六進位/十進位） |
| **顯示資訊面板（Show Info Panel）(_I)** | 顯示/隱藏右側資訊面板 |

**進階選項**：

| 項目 | 功能 |
|------|------|
| **自動寫入（Auto Write）(_W)** | 啟用自動寫入功能 |
| **自動驗證（Auto Verify）(_V)** | 啟用自動驗證功能（*需先啟用自動寫入*） |

## 顏色標示說明

| 顏色 | 意義 |
|------|------|
| **黑色** | 預設值，未變更 |
| **藍色** | 已修改，尚未寫入硬體 |
| **綠色** | 寫入成功且驗證通過 |
| **紅色** | 錯誤或驗證失敗 |
| **黃色** | 最近變更 |

## 設定匯入/匯出

- **載入設定**（File 選單）：匯入先前儲存的暫存器設定檔
- **儲存設定**（File 選單）：將目前暫存器狀態匯出為檔案

### 支援的檔案格式

| 格式 | 副檔名 | 說明 |
|------|--------|------|
| **JSON（明文）** | `.json` | 目前的標準格式，包含完整中繼資料 |
| **CSV（舊格式）** | `.csv` | 舊版暫存器設定格式，載入時自動轉換為 JSON |

### 載入舊版 CSV 設定檔並轉換為 JSON

若您擁有舊版 CSV 格式的暫存器設定檔，系統支援自動偵測並轉換為新版 JSON 格式。

#### CSV 舊格式範例

```csv
Address, Value, Address(0x), Value(0x), Name
0, 0, 0x00, 0x00, ONTCtl
10, 5, 0x0A, 0x05, CONTROL_REG
20, 255, 0x14, 0xFF, STATUS_REG
Chip, G8202L,,,
Crc16, 55002, 0xD6DA,,
```

**CSV 欄位說明**：

| 欄位 | 說明 |
|------|------|
| **Address** | 暫存器位址（十進位） |
| **Value** | 暫存器數值（十進位） |
| **Address(0x)** | 暫存器位址（十六進位） |
| **Value(0x)** | 暫存器數值（十六進位） |
| **Name** | 暫存器名稱 |

**中繼資料列**（位於資料列之後）：
- `Chip, <晶片名稱>,,,` — 晶片識別（如 `G8202L`）
- `Crc16, <CRC值>, <CRC十六進位>,,` — CRC-16 校驗碼

> **注意**：若 CSV 檔案中無晶片中繼資料，系統會從檔案名稱自動擷取。
> 例如：`G8202L_D6DA_260123_211326.csv` → 晶片名稱為 `G8202L`

#### JSON 新格式範例

```json
{
  "chipTag": "G8202L",
  "chipName": "G8202L",
  "savedMode": "UserMode",
  "timestamp": "2026-02-14T12:34:56.789Z",
  "registerCrc": 55002,
  "appVersion": "1.0.0",
  "firmwareVersion": "26010200",
  "attributes": {},
  "extendedAttributes": {},
  "registers": [
    { "name": "ONTCtl", "address": 0, "value": 0, "size": 8 },
    { "name": "CONTROL_REG", "address": 10, "value": 5, "size": 8 },
    { "name": "STATUS_REG", "address": 20, "value": 255, "size": 8 }
  ]
}
```

**JSON 相較 CSV 新增的中繼資料**：

| 欄位 | 說明 |
|------|------|
| `savedMode` | 儲存時的操作模式 |
| `timestamp` | 儲存時間（ISO 8601 格式） |
| `appVersion` | 應用程式版本 |
| `firmwareVersion` | 韌體版本 |
| `attributes` | 晶片特定屬性 |
| `extendedAttributes` | 擴充屬性（晶片家族特定） |

#### 轉換操作步驟

1. 點擊 **File** 選單 → **Load Config**（或在暫存器樹狀檢視中右鍵 → **Load Register Config**）
2. 在檔案選擇對話框中，選擇 `.csv` 檔案
3. 系統偵測到舊版 CSV 格式後，彈出確認視窗：「偵測到舊版 CSV 格式，是否自動轉換為 JSON？」
4. 點擊「是」確認轉換
5. 系統自動解析 CSV 內容，並補充以下資訊：
   - 目前的應用程式版本（`appVersion`）
   - 目前的韌體版本（`firmwareVersion`）
6. 選擇輸出路徑，儲存為明文 JSON 格式（`.json`）
7. 轉換完成後，系統自動載入轉換後的設定

#### 轉換流程圖

```
選擇 .csv 檔案
    ↓
系統偵測為 CSV 格式
    ↓
確認轉換對話框 → 取消 → 結束
    ↓ 確認
解析 CSV 資料（位址、數值、名稱）
    ↓
讀取晶片中繼資料（Chip 列 或 檔案名稱）
    ↓
補充版本資訊（AppVersion、FirmwareVersion）
    ↓
儲存為明文 JSON（.json）
    ↓
選擇輸出路徑並儲存
    ↓
載入轉換後的暫存器設定
```

#### 轉換後的檔案命名規則

CSV 轉換時，系統保留原始 CSV 檔名，僅變更副檔名：

```
原始檔案：G8202L_D6DA_260123_211326.csv
轉換結果：G8202L_D6DA_260123_211326.json
```

| 項目 | 說明 |
|------|------|
| **檔名主體** | 與原始 CSV 檔名完全相同 |
| **副檔名** | 變更為 `.json` |
| **備援檔名** | 若檔名解析失敗，使用 `converted.json` |

> **對照：正常儲存的檔名格式**
>
> 透過 File → Save Config 儲存時，系統會自動產生建議檔名，格式為：
>
> `{晶片名稱}_{CRC16十六進位}_{時間戳記}`
>
> 範例：`G8202L_A1B2_20260214_143056`
>
> 其中 CRC16 為 4 位十六進位校驗碼，時間戳記格式為 `yyyyMMdd_HHmmss`。

#### 晶片標籤比對規則

載入設定時，系統會比對檔案中的晶片標籤與目前選擇的晶片。若標籤不符，系統會顯示錯誤訊息並終止載入。
